<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
<!--jQuery UI CSS-->
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.css" type="text/css" media="screen" />
<!-- Exercises styles-->
<link rel="stylesheet" href="exercises.css" />
<!--jQuery and jQuery UI with jQuery Chat-->
<script type="text/javascript" src="jquery-1.8.3.js"></script>
<script type="text/javascript" src="jquery-ui.js"></script>
<link type="text/css" href="jquery.ui.chatbox.css" rel="stylesheet" />
<script type="text/javascript" src="jquery.ui.chatbox.js"></script>
<script src='moment.js'></script>
<script src='fullcalendar.js'></script>

<script type="text/javascript">

    var hasStarted = false;

    var getUrlParameter = function(param) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === param) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    };

    function sendMessageDocToPatient(name, message) {
        $("#chat_div").chatbox("option", "boxManager").addMsg(name, message);
    }

    function getTimeRemaining(endtime) {
        var t = Date.parse(endtime) - Date.parse(new Date());
        var seconds = Math.floor((t / 1000) % 60);
        var minutes = Math.floor((t / 1000 / 60) % 60);
        return {
            'total': t,
            'minutes': minutes,
            'seconds': seconds
        };
    }

    function initializeClock(id, endtime, start) {
        if (hasStarted) return;
        if (start) hasStarted = true;
        var clock = document.getElementById(id);
        var minutesSpan = clock.querySelector('.minutes');
        var secondsSpan = clock.querySelector('.seconds');

        function updateClock() {
            var t = getTimeRemaining(endtime);
            minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
            secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

            if (t.total <= 0) {
                clearInterval(timeinterval);
            }
        }

        updateClock();
        if (start) {
            var timeinterval = setInterval(updateClock, 1000);
        }
    }

    var calendarSelectedDay;

    $(document).ready(function() {
        var numberOfMessages = 0;

        calendarSelectedDay = getUrlParameter("date");

        box = $("#chat_div").chatbox( {
            id:"Me",
            user:
                {
                    key : "value"
                },
            title : "Messages to Doc Brown",
            // right_offset: 0, // relative to the right of the screen
            // bottom_offset: 0, // relative to the bottom of the browser window

            messageSent : function(id, user, msg) {
                $("#chat_div").chatbox("option", "boxManager").addMsg(id, msg);
                numberOfMessages += 1;
                if (numberOfMessages == 1) {
                    setTimeout('sendMessageDocToPatient("Doc Brown", "I\'ll take care of it!");', 2000);
                }

            }
        });
        if (numberOfMessages == 0) {
            sendMessageDocToPatient("Doc Brown", "How's the training going?");
        }

        var deadline = new Date(Date.parse(new Date()) + 1 * 60 * 1000); // SET TIMER LENGTH HERE
        initializeClock('clockdiv', deadline, false);

    });


</script>
</head>


<body>

<div class="page_title" height="100%">
    <p class="page_title_text">PhysicalRehab.io</p>
</div>

<div class="top">
    <div class="description">
        <p class="description_header">Tree for 1 minute</p>
        <p class="description_text">Stand with your feet together, toes all facing forward, hands on hips. Elevate your right knee to hip height. Turn out your right hip and place the entire sole of your foot onto your left calf or inner thigh (grab your ankle to hike the foot up to the thigh). With an MCL tear, you might not be able to turn your hip/leg out a lot at first. Ease into this external rotation over time. It can take months to get to a full turnout. Keep your gaze steady on a single focal point. Hold for 5 breaths. Build to 10 breaths and ultimately one minute. Repeat with the left leg.</p>
    </div>
    <div class="video">
        <iframe class="exercise_video" src="https://www.youtube.com/embed/wdln9qWYloU" frameborder="0" allowfullscreen></iframe>
    </div>
    <div id="messages" class="messages">
        <div id="chat_div"></div>
    </div>
</div>

<div class="bottom">
    <div class="clock">
        <div id="clockdiv">
            <div>
                <span class="minutes"></span>
                <div class="smalltext">Minutes</div>
            </div>
            <div>
                <span class="seconds"></span>
                <div class="smalltext">Seconds</div>
            </div>
        </div>
        <button class="start_button" onclick="initializeClock('clockdiv', new Date(Date.parse(new Date()) + 1 * 60 * 1000), true)">Start</button>
    </div>

    <div class="check">
        <a href="index.html?status=check&exercise=tree" onclick="location.href=this.href+'&date='+calendarSelectedDay; return false;" class="button-check"></a>
    </div>

    <div class="flag">
        <a href="index.html?status=flag&exercise=tree" onclick="location.href=this.href+'&date='+calendarSelectedDay; return false;" class="button-flag"></a>
    </div>
</div>

</body>
</html>